# nonebot-plugin-kirya-ai-chat

一个基于 Nonebot 的插件，用于从事件中提取关键信息并发送给 AI，获取回复后在聊天软件中实现 AI 对话，原始适配环境为 QQ。

A Nonebot-based plugin that extracts key information from events, sends it to AI, and retrieves responses to enable AI conversations on messaging platforms, originally adapted for QQ.


## 项目说明

- 为减少重复性工作，部分代码由 AI 辅助生成。
- 若使用中遇到问题，作者不保证能够解决。
- 功能描述兼顾开发者自身与协作工具的可读性。

## 已实现功能

### 消息触发逻辑

- **私聊场景**：非指令消息直接触发 AI 回复；指令消息直接触发。
- **群聊场景**：非指令消息需 @ 机器人触发；指令消息直接触发。
- **指令识别**：以 `\` 反斜杠开头的消息视为指令，若指令存在则执行对应功能。


### 核心指令列表（按功能分类）

| 指令名   | 功能描述                                                     |
| -------- | ------------------------------------------------------------ |
| `reply`  | 启用/禁用 AI 回复（禁用时，非指令消息不会触发 AI 回复）      |
| `prompt` | 管理提示词（支持写入、删除、启用、禁用、阅读，按写入顺序排列） |
| `help`   | 输出所有指令及用法（按英文名字典序排列）                     |
| `model`  | 切换 AI 模型（当前支持 Gemini 和 Deepseek，可扩展性待实现）  |
| `split`  | 启用/禁用消息分割（通过提示词让 AI 插入分隔符，从而将长消息自动拆分为多条短消息，这一行为是为了让 AI 的回复形式更贴近真实 QQ 用户） |
| `memory` | 管理 AI 记忆（AI 在特定条件下会总结历史对话，记忆内容包含 AI 的总结和最近的聊天记录） |


### AI 消息组成逻辑

发送给 AI 的内容结构为：  
`[设置的提示词] + [分隔符提示词（若启用 split）] + [AI 记忆-内容总结] + [AI 记忆-聊天记录] + [新输入的聊天消息]`


## 待实现功能

- 将状态性配置迁移至本地存储（便于修改和规避循环调用）
- 细化指令功能，提升交互体验
- 统一代码风格，消除 AI 生成代码的差异性
- 优化群聊触发逻辑，支持非 @ 唤醒
- 增强指令执行安全性，避免过量/异常输出被 QQ 官方限制
